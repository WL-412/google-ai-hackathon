(()=>{let e=null;async function t(t,n,o=""){try{return e||await async function(t,n){e=await ai.languageModel.create({...t,systemPrompt:`You are helping a user understand and answer questions about this article: "${n}".`})}(n,o),console.log("Running prompt",t),e.prompt(t)}catch(t){throw console.error("Prompt failed:",t),async function(){e&&e.destroy(),e=null}(),t}}chrome.runtime.onMessage.addListener(((e,n,o)=>{const a={temperature:.7,topK:5};if("summarize_page"===e.action)console.log("Message received"),t("Generate 5 questions based on the key points of the article. Give me questions only, no other text.",a,e.content).then((e=>{chrome.tabs.sendMessage(n.tab.id,{action:"display_summary",summary:e}),console.log("Summary sent",e)})).catch((e=>console.error("Error summarizing content:",e)));else if("validate_answer"===e.action){const{question:o,userAnswer:a,index:r}=e;(async function(e,n){return t(`Under the context of the above article, evaluate the answer to this question: "${e}" with the user answer: "${n}". Respond with only the word 'Correct' if the answer is basically correct, otherwise don't include "correct" and provide a hint starting with 'Hint: '.`,{temperature:.7,topK:5})})(o,a).then((e=>{chrome.tabs.sendMessage(n.tab.id,{action:"display_feedback",feedback:e,index:r}),console.log("Feedback sent",e)})).catch((e=>console.error("Error validating answer:",e)))}}))})();