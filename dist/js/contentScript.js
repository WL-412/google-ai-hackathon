(()=>{if(console.log("content script running"),!document.getElementById("floating-sidebar-root")){const e=document.createElement("div");e.id="floating-sidebar-root",document.body.appendChild(e)}chrome.runtime.onMessage.addListener(((n,o,i)=>{if(console.log("Message received in content script:",n),"extract_content"===n.action)i({content:function(){const e=document.querySelectorAll("article p");let t="";return e.forEach((e=>{t+=e.innerText+"\n"})),console.log("Extracted page content:",t),t}()});else if("start_highlight_mode"===n.action){const{index:o}=n;!function(n){e=!0,document.addEventListener("mouseup",(()=>t(n))),console.log("Highlight mode activated.")}(o),i({status:"Highlight mode started"})}}));let e=!1;function t(n){if(!e)return;const o=window.getSelection();if(o&&o.toString().trim()){const i=o.toString();console.log("Highlighted text:",i);const c=o.getRangeAt(0),d=document.createElement("span");d.style.background="lightblue",d.style.borderRadius="3px",d.textContent=i,c.deleteContents(),c.insertNode(d),chrome.runtime.sendMessage({action:"text_highlighted",text:i,index:n}),e=!1,document.removeEventListener("mouseup",t),console.log("Highlight mode deactivated.")}}})();