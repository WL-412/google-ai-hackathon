(()=>{if(console.log("content script running"),!document.getElementById("floating-sidebar-root")){const e=document.createElement("div");e.id="floating-sidebar-root",document.body.appendChild(e)}chrome.runtime.onMessage.addListener(((o,i,c)=>{if(console.log("Message received in content script:",o),"extract_content"===o.action)c({content:function(){const e=document.querySelectorAll("article p");let t="";return e.forEach((e=>{t+=e.innerText+"\n"})),console.log("Extracted page content:",t),t}()});else if("start_highlight_mode"===o.action){const{index:i}=o;!function(o){e=!0,t=o,document.addEventListener("mouseup",n),console.log("Highlight mode activated.")}(i),c({status:"Highlight mode started"})}}));let e=!1,t=null;function n(o){if(!e)return;const i=window.getSelection();if(i&&i.toString().trim()){const o=i.toString(),c=i.getRangeAt(0),d=document.createElement("span");d.style.background="lightblue",d.style.borderRadius="3px",d.textContent=o,c.deleteContents(),c.insertNode(d),chrome.runtime.sendMessage({action:"text_highlighted",text:o,index:t}),e=!1,t=null,document.removeEventListener("mouseup",n),console.log("Highlight mode deactivated.")}}})();